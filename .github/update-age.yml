name: Update Age

permissions:
  contents: write

on:
  schedule:
    - cron: '0 0 * * *' # run daily at midnight UTC
  workflow_dispatch: {} # allow manual runs for testing
  push:
    branches:
      - main

jobs:
  update-readme:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.x'

    - name: Calculate age and update README
      env:
        BIRTHDATE: '2001-02-25'
      run: |
        python - <<'PY'
        from datetime import date, datetime
        import re

        birth = datetime.strptime('${{ env.BIRTHDATE }}', '%Y-%m-%d').date()
        today = date.today()
        age = today.year - birth.year - ((today.month, today.day) < (birth.month, birth.day))
        print('Computed age:', age)

        path = 'README.md'
        with open(path, 'r', encoding='utf-8') as f:
            text = f.read()

        new_text, n = re.subn(r"\b\d+-year-old\b", f"{age}-year-old", text, count=1)
        if n:
            with open(path, 'w', encoding='utf-8') as f:
                f.write(new_text)
            print(f'Updated README.md: replaced {n} occurrence(s)')
        else:
            print('No age pattern found to replace in README.md')
        PY

    - name: Commit & push if changed
      run: |
        git config --global user.name 'github-actions[bot]'
        git config --global user.email 'github-actions[bot]@users.noreply.github.com'
        git add README.md || true
        if git diff --staged --quiet; then
          echo 'No changes to commit'
        else
          git commit -m "Update age in README"
          git push
        fi
